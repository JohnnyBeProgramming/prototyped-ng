<!DOCTYPE html>
<!--[if lt IE 10]>  <html lang="en" class="no-js lt-ie-edge lt-ie-10"> <![endif]-->
<!--[if IE 10]>     <html lang="en" class="no-js lt-ie-edge"> <![endif]-->
<!--[if gt IE 10]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<head>
    <base href="/">
    <title>Prototyped</title>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <style type="text/css">
        /* Define cloak style (hides un-parsed content) */
        .ng-cloak, [ng-cloak], ng-cloak, [ng\3A cloak] {
            display: none;
        }

        /* Lets define some basic styling for our IE friends */
        body.lt-ie-10 {
            margin: 0;
            padding: 16px;
            font-size: 14px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            background-color: white;
        }

        .lt-ie-10 .footer, .lt-ie-10 #myLoader {
            display: none;
        }

        .lt-ie-10 #preLoader.app-error {
            color: #ff0000;
            padding-left: 16px;
            margin: 0;
        }

        .browsehappy {
            margin: 0;
            padding: 16px;
            color: #808080;
            border: solid 1px silver;
            background-color: rgb(240, 240, 240);
        }

        /* Just to be safe, define basic styling (helps when css is still loading) */
        body {
            margin: 0;
            padding: 0;
        }

        #myApp .navbar-fixed-top ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }

            #myApp .navbar-fixed-top ul li {
                padding: 0;
                list-style: none;
            }

        .sidebar ul {
            margin: 0;
            padding: 0;
            width: 100%;
            list-style: none;
            display: inline-block;
        }

        .top-hint {
            text-align: center;
        }

            .top-hint .tab {
                top: 0;
                width: 320px;
                height: 24px;
                padding: 2px 6px;
                margin-left: -160px;
                z-index: 4000;
                text-wrap: avoid;
                border-top: none;
                position: absolute;
                border-radius: 0 0 10px 10px;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }

                .top-hint .tab a {
                    color: black;
                }

        }
    </style>
    <link href="assets/favicon.png" rel="shortcut icon">
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />

    <!-- build:js ../app/assets/lib/app.cdn.min.js -->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.2.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/modernizr/modernizr-2.6.2.js"></script>
    <!-- endbuild -->
    <!--[if gt IE 10]><!-->
    <script>

        // Define configuration
        var appConfig = {
            wait: true,
            done: false,
            pass: null,
            vend: [
                'https://cdnjs.cloudflare.com/ajax/libs/angular-ui-utils/0.1.1/angular-ui-utils.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.13/angular-ui-router.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.0/ui-bootstrap-tpls.min.js',
            ],
            libs: [
                // Define the required libraries
                'assets/lib/version.js',
                'assets/lib/app.templates.js',
                'assets/lib/app.js',
            ],
            progress: {
                timerSteps: 0,
                timerCount: 120, // 2m = 2 * 60s = 120s
                timerPercn: 0.2,
                timerIntvl: null,
                timerDelay: 500,
                percentage: function (fraction, total) { return (100.0 * fraction) / total },
                countTotal: function () { return appConfig.vend.length + appConfig.libs.length + appConfig.progress.timerCount },
                countVend: function () { return appConfig.wait ? 0 : appConfig.vend.length },
                countLibs: function () { return !appConfig.done ? 0 : appConfig.libs.length },
            },
            loaderInit: function () {
                try {

                    // Define required vendor libraries...
                    appConfig.pass = null;
                    appConfig.wait = true;
                    appConfig.vend = (appConfig.vend || []).concat([
                        'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js',
                        'https://cdn.jsdelivr.net/angular.moment/0.9.0/angular-moment.min.js',
                    ]);

                    // Bootstrap the angular loading app (pre-loading)
                    angular.module('myLoader', ['angular-loading-bar', 'ngAnimate'])

                        .run(['$rootScope', function ($rootScope) {

                            // Add the loader config to the root scope
                            $rootScope.cfg = appConfig;
                            console.debug(' - Application Loader started.');

                            // Set a timer to check forupdates
                            appConfig.progress.timerIntvl = setInterval(function () {
                                $rootScope.$apply(function () {
                                    appConfig.loaderChecker();
                                });
                            }, appConfig.progress.timerDelay);
                        }]);
                    angular.bootstrap($('#myLoader'), ['myLoader']);

                } catch (ex) {
                    return false; // Loader failed to initialise
                }
                return true; // Initialised loader...
            },
            loaderChecker: function () {
                var prog = appConfig.progress;
                var max = appConfig.progress.countTotal();

                // Check for timeout
                if (prog.timerSteps >= prog.timerCount) {
                    appConfig.loaderFailed();
                }

                // Check if done
                if (appConfig.done) {
                    appConfig.pass = true;
                    //console.debug(' - Closing...');
                    clearInterval(appConfig.progress.timerIntvl);
                } else {
                    if (max > 0) {
                        prog.timerSteps++;
                        prog.progTime = prog.percentage(prog.timerSteps, max);
                        prog.progVend = prog.percentage(prog.countVend(), max);
                        prog.progLibs = prog.percentage(prog, max);
                    }
                }
            },
            loaderFailed: function () {
                var msg = 'Resources missing or unavailable';
                console.warn(' - Warning: ' + msg);
                $('.app-loading').addClass('app-error');
                $('.app-loading label').html(msg);
                if (typeof require !== 'undefined') {
                    $('#btnCloseWindow').removeClass('ng-cloak');
                    $('#btnCloseWindow').click(function (evt) {
                        var gui = require('nw.gui');
                        var win = gui.Window.get();
                        if (win) {
                            win.close();
                        }
                        evt.stopPropagation();
                        return false;
                    });
                }

                // Clear waiting/done flags
                appConfig.wait = false;
                appConfig.done = true;
                appConfig.pass = false;
            },
            loading: function () {
                // Load additional JS libraries here...
                appConfig.libs = [
                    'modules/default.ng.js',
                    'modules/about.ng.js',
                ].concat(appConfig.libs);

                // Clear waiting flag
                appConfig.wait = false;
            },
            starting: function () {
                // When all is done, bootstrap our angular app
                console.debug(' - Start AngularJS...');
                angular.bootstrap($('#myApp'), ['myApp']);

                // Set done flag
                appConfig.done = true;
            },
        };
    </script>
    <!--<![endif]-->
</head>
<body>
    <!--[if lt IE 10]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a target="_self" href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]-->

    <div id="myApp" class="docked">
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-inner">
                <ul class="nav navbar-nav navheading ng-cloak">
                    <li class="dock-fill">
                        <a app:clean href="" class="navbar-brand" role="button">
                            <i class="fa fa-cubes" ng:class="status.getColor()"></i> <span>Prototyped</span>
                        </a>
                    </li>
                    <li class="dock-tight ng-cloak" ng:show="state.current.name != 'home'">
                        <a app:nav-link ui:sref="home" class="pull-right">
                            <i class="glyphicon glyphicon-chevron-left"></i>
                        </a>
                    </li>
                </ul>
                <span ui:view="menu" class="ng-cloak">
                    <!-- Begin: Default menu toolbar -->
                    <ul class="nav navbar-nav" app:menu="appMenu.items"></ul>
                    <!-- End: Default menu toolbar -->
                </span>
                <ul class="nav navbar-nav pull-right toolbar-ctrls">
                    <li class="ng-cloak"><a app:clean href=""><i class="glyphicon glyphicon-refresh"></i></a></li>
                    <li class="ng-cloak"><a app:debug href=""><i class="glyphicon glyphicon-wrench"></i></a></li>
                    <li class="ng-cloak"><a app:kiosk href=""><i class="glyphicon glyphicon-fullscreen"></i></a></li>
                    <li class="ng-cloak" id="btnCloseWindow">
                        <a app:close href=""><i class="glyphicon glyphicon-remove"></i></a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="docked viewport">
            <div class="sidebar ng-cloak" ui:view="left" ng:show="state.current.views['left'] || state.current.views['left@']"></div>
            <div class="contents docked" ui:view="main">

                <!-- This loader is used as a place-holder for main contents  -->
                <div id="preLoader" class="app-loading">
                    <div class="loadtext">
                        <label id="preLoaderText">Loading, please wait...</label>
                        <div class="spinner">
                            <div class="rect1"></div>
                            <div class="rect2"></div>
                            <div class="rect3"></div>
                            <div class="rect4"></div>
                            <div class="rect5"></div>
                            <div class="rect7"></div>
                            <div class="rect7"></div>
                            <div class="rect8"></div>
                            <div class="rect9"></div>
                            <div class="rect10"></div>
                            <div class="rect11"></div>
                            <div class="rect12"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="footer">
            <span class="pull-left">
                <label ng:show="status.logs | typeCount:'error'">
                    <i class="glyphicon glyphicon-exclamation-sign glow-red"></i>
                    <a href="" class="ng-cloak">Errors ({{ status.logs | typeCount:'error' }})</a>
                </label>
                <label ng:show="status.logs | typeCount:'warn'" class="ng-cloak">
                    <i class="glyphicon glyphicon-warning-sign glow-orange"></i>
                    <a href="">Warnings ({{ status.logs | typeCount:'warn' }})</a>
                </label>
            </span>
            <span ng:if="true" class="ng-cloak">
                Client Version: <span app:version><em>Loading...</em></span> |
            </span>
            <span ui:view="foot">
                Powered by <a href="https://angularjs.org/">AngularJS</a> &amp; <a href="https://github.com/rogerwang/node-webkit">Node Webkit</a>
            </span>
            <span ng:if="startAt" class="ng-cloak">| Started {{ startAt | fromNow }}</span>
        </div>
    </div>

    <div id="myLoader" class="ng-cloak" ng:show="false">
        <div class="active progress progress-striped">
            <div ng:init="progC = 0.15" role="progressbar" aria-valuenow="{{ progC }}" aria-valuemin="0" aria-valuemax="100"
                 class="progress-bar" ng-class="'progress-bar-warning'"
                 ng-style="{width: (100 * progC) + '%'}" aria-valuetext="{{ (100.0 * progC) + ' %' }}%">
                <span ng:show="cgf.progress">Requests ( {{ cgf.progress.timerSteps }} / {{ cgf.progress.timerCount }} ) </span>
            </div>
            <div ng:init="progA = 0.25" role="progressbar" aria-valuenow="{{ progA }}" aria-valuemin="0" aria-valuemax="100"
                 class="progress-bar" ng-class="'progress-bar-info'"
                 ng-style="{width: (100 * progA) + '%'}" aria-valuetext="{{ (100.0 * progA) + ' %' }}%">
                <span ng:show="cgf.progress">Libraries ( {{ cgf.progress.timerSteps }} / {{ cgf.progress.timerCount }} ) </span>
            </div>
            <div ng:init="progB = 0.4" role="progressbar" aria-valuenow="{{ progB }}" aria-valuemin="0" aria-valuemax="100"
                 class="progress-bar" ng-class="'progress-bar-primary'"
                 ng-style="{width: (100 * progB) + '%'}" aria-valuetext="{{ (100.0 * progB) + ' %' }}%">
                <span ng:show="cgf.progress">Application ( {{ cgf.progress.timerSteps }} / {{ cgf.progress.timerCount }} ) </span>
            </div>
        </div>
    </div>

    <!-- Load AngularJS and all the required libraries -->
    <!--[if gt IE 10]><!-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/less.js/2.3.1/less.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular-animate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-loading-bar/0.6.0/loading-bar.min.js"></script>
    <script src="assets/lib/app.loader.js"></script>
    <!--<![endif]-->
    <script>

        // Define helper method to set error meesage
        function setMessage(message, css) {
            var elemBody = document.getElementById('preLoader');
            if (elemBody && css) elemBody.className += ' ' + css;

            var elemLabel = document.getElementById('preLoaderText');
            if (elemLabel) elemLabel.innerHTML = '<b>Error:</b> ' + message;
        }

        // Only bootstrap if loader is available...
        var isAvailable = typeof $script !== 'undefined';
        if (isAvailable) {

            // Initialise the app loader
            if (appConfig.loaderInit()) {

                // Load all dependencies asynchronously.
                $script(appConfig.vend, function () {
                    // Initialise
                    appConfig.loading();

                    // Load all of the dependencies asynchronously.
                    $script(appConfig.libs, appConfig.starting);
                });

            } else {
                // Script loader or a required dependency missing
                setMessage('Required libraries missing!', 'app-error');
            }
        } else {
            // The current browser is not supported
            setMessage('Application failed to load!', 'app-error');
        }

    </script>
</body>
</html>
