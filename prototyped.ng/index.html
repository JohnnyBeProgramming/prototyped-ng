<!DOCTYPE html>

<html lang="en">
<head>
    <base href="/">
    <meta charset="utf-8" />
    <title>Module Sandbox</title>

    <!-- Load AngularJS and all the required libraries (exclude IE < 10 from the party) -->
    <!--[if gt IE 9]><!-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/less.js/2.3.1/less.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular-route.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular-animate.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-loading-bar/0.6.0/loading-bar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-utils/0.1.1/angular-ui-utils.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.13/angular-ui-router.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.0/ui-bootstrap-tpls.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.js"></script>
    <script src="https://cdn.jsdelivr.net/angular.moment/0.9.0/angular-moment.js"></script>
    <!--<![endif]-->
    <!-- Load this module's libraries -->
    <script src="assets/lib/prototyped.ng.base.js"></script>
    <script src="assets/lib/prototyped.ng.sqlx.js"></script>
    <script src="assets/lib/prototyped.ng.styles.js"></script>
    <!--script src="assets/lib/prototyped.ng.resx.js"></script -->
    <script>
        // Mock the template cache (clears pre-loaded templates and load rather from source)
        angular.module('prototyped.ng.views', []).run(['$templateCache', function ($templateCache) { }]);
        //angular.module('prototyped.ng.sql', []).run(['$templateCache', function ($templateCache) { }]);
    </script>

    <!-- Load some styles and logic just for testing this app... -->
    <script src="index.js"></script>
</head>
<body id="testApp">
    <style resx:import="assets/css/app.min.css"></style>
    <style resx:import="assets/css/prototyped.min.css"></style>
    <div id="menu">
        <div class="dragable">
            <a ui:sref="default" class="pull-right btn btn-default">Home</a>
        </div>
        <div ui:view="menu">
            <ul class="nav navbar-nav">
                <li ui:sref-active="open">
                    <a ui:sref="default">Default</a>
                </li>
                <li ui:sref-active="open">
                    <a ui:sref="proto.cmd">Features</a>
                </li>
                <li ui:sref-active="open">
                    <a ui:sref="about.info">About</a>
                </li>
            </ul>
        </div>
    </div>
    <div id="contents">
        <div id="left" ui:view="left"
             ng:show="state.current.views['left'] || state.current.views['left@']">
            <em>Left View</em>
        </div>
        <div id="main" ui:view="main">
            <em>Main View</em>
        </div>
    </div>
    <div id="footer" ui:view="footer">
        <em>Footer View</em>
    </div>
    <script>
        // Load the config (async) and bootstrab angular
        !(function (window, angular, elem, ngTargetApp, configUrl) {
            window.onload = function () {
                if (!configUrl) {
                    console.log('Starting app ' + ngTargetApp + '...');
                    angular.bootstrap(elem, [ngTargetApp]);
                } else {
                    var $http = angular.injector(['ng']).get('$http');
                    $http({
                        method: 'GET',
                        url: configUrl,
                    }).success(function (data, status, headers, config) {
                        console.log('Configuring ' + ngTargetApp + '...')
                        var cfgModule = angular.module('prototyped.ng.config');
                        var oldConfig = angular.injector(['prototyped.ng.config']).get('appConfig');
                        angular.extend(oldConfig, {
                            version: data.version,
                        })
                        cfgModule.constant('appConfig', oldConfig);
                        angular.bootstrap(elem, [ngTargetApp]);
                    }).error(function (ex) {
                        console.log(' - Starting ' + ngTargetApp + ' with default config.');
                        angular.bootstrap(elem, [ngTargetApp]);
                    });
                }
            };
        }(window, angular, $('#testApp'), 'testApp', 'package.json'));
    </script>
</body>
</html>